<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>CorrectBatches — CorrectBatches • Canek</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="CorrectBatches — CorrectBatches"><meta property="og:description" content="Batch-effect correction over a list of single cell batches"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-52309538-4"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-52309538-4');
</script></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Canek</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.2.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/Best_practices_thymus.html">Best practices on batch effects correction</a>
    </li>
    <li>
      <a href="../articles/SingleCellExperiment.html">Run Canek on SingleCellExperiment objects</a>
    </li>
    <li>
      <a href="../articles/seurat.html">Run Canek on Seurat objects</a>
    </li>
    <li>
      <a href="../articles/toy_example.html">Run Canek on a toy example</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>CorrectBatches</h1>
    
    <div class="hidden name"><code>CorrectBatches.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Batch-effect correction over a list of single cell batches</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">CorrectBatches</span><span class="op">(</span></span>
<span>  <span class="va">lsBatches</span>,</span>
<span>  hierarchical <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  queNumCelltypes <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  maxMem <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  sampling <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  numSamples <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  kNN <span class="op">=</span> <span class="fl">30</span>,</span>
<span>  pcaDim <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  pairsFilter <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  perCellMNN <span class="op">=</span> <span class="fl">0.08</span>,</span>
<span>  fuzzy <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  fuzzyPCA <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  estMethod <span class="op">=</span> <span class="st">"Median"</span>,</span>
<span>  clusterMethod <span class="op">=</span> <span class="st">"louvain"</span>,</span>
<span>  doCosNorm <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  fracSampling <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  debug <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>lsBatches</dt>
<dd><p>List of batches to integrate. Batches should contain the same number of genes as rows.</p></dd>


<dt>hierarchical</dt>
<dd><p>Use hierarchical integration scheme when correcting more than two batches.
If set to FALSE, the input batches are sorted by number of cells and integrated on descending order.</p></dd>


<dt>queNumCelltypes</dt>
<dd><p>Number of cell types in the query batch. By default Canek searches the number of
cell types using an heuristic algorithm. Change this parameter if you know the number of cell types in advanced.</p></dd>


<dt>maxMem</dt>
<dd><p>Maximum number of memberships from the query batch. This parameter is used on the heuristic algorithm to find the number of cell types.</p></dd>


<dt>sampling</dt>
<dd><p>Use MNNs pairs sampling when using a Kalman filter to estimate the correction vector.</p></dd>


<dt>numSamples</dt>
<dd><p>If sampling. Number of MNNs pairs samples to use on the estimation process.</p></dd>


<dt>kNN</dt>
<dd><p>Number of k-nearest-neighbors used to define the MNNs pairs.</p></dd>


<dt>pcaDim</dt>
<dd><p>Number of PCA dimensions to use.</p></dd>


<dt>pairsFilter</dt>
<dd><p>Filter MNNs pairs before estimating the correction vectors. If TRUE,
the pairs are filtered from outliers using an interquartile range method.</p></dd>


<dt>perCellMNN</dt>
<dd><p>Threshold value to decide if a membership's correction value is calculated.
As a rough interpretation, this values can be thought as the proportion of cells from a membership
with an associated MNN pair. If the proportion is low, an specific correction vectors is
not calculated for this membership.</p></dd>


<dt>fuzzy</dt>
<dd><p>Use fuzzy logic to join the local correction vectors.</p></dd>


<dt>fuzzyPCA</dt>
<dd><p>Number of PCs to use in the fuzzy process.</p></dd>


<dt>estMethod</dt>
<dd><p>Method to use when estimating the correction vectors:</p><ul><li><p>Median. Use the cells median distance</p></li>
<li><p>EKF. Use an extended Kalman filter</p></li>
</ul></dd>


<dt>clusterMethod</dt>
<dd><p>Method used to identify memberships.</p></dd>


<dt>doCosNorm</dt>
<dd><p>Whether to do cosine normalization.</p></dd>


<dt>fracSampling</dt>
<dd><p>Fraction of cells to sample in the hierarchical selection (default is NULL, no sampling).</p></dd>


<dt>debug</dt>
<dd><p>Return correction's information</p></dd>


<dt>verbose</dt>
<dd><p>Print output.</p></dd>


<dt>...</dt>
<dd><p>Pass down methods from RunCanek().</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>A list containing the integrated datasets as matrix and the correction data .</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>CorrectBatches is a method to correct batch-effect from two or more single-cell batches.
Batch-effects observations are defined using mutual nearest neighbors (MNNs) pairs and cell
groups from the query batch are distinguished using clustering. We estimate a correction vector
for each cluster using its MNNs pairs and use these vectors to remove the batch effect from the query batch in two ways:</p><ul><li><p>A linear correction is performed by equally correcting the cells from the same cluster.</p></li>
<li><p>A non-linear correction is performed by differently correcting each cell using fuzzy logic.</p></li>
</ul></div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">Batches</span> <span class="op">&lt;-</span> <span class="va">SimBatches</span><span class="op">$</span><span class="va">batches</span></span></span>
<span class="r-in"><span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu">CorrectBatches</span><span class="op">(</span><span class="va">Batches</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">Uncorrected_PCA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">prcomp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">Batches</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="va">Batches</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Uncorrected_PCA</span><span class="op">$</span><span class="va">x</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="CorrectBatches-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="va">Corrected_PCA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">prcomp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Corrected_PCA</span><span class="op">$</span><span class="va">x</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="CorrectBatches-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Martin Loza, Diego Diez.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

